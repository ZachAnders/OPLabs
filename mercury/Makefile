# This file was autogenerated using ./genmake.sh You should not have to edit
# this file by hand!  If you do have to edit this file by hand please contact
# the sourceror
#
# To modify the different attributes of everything, check out the targets
# directory as it contains all the configuration for compilation.
#
# The genmake script will track dependencies and automatically add them to the
# make script. This includes header dependencies.
#
# In this make file, there is a concept of a target (TGT) and environment (ENV)
# The target tells the make file for which architecture we are building
# Currently only two are configured: x86 and i386.
#
# The environment specifies what environment we are using (e.g. devel, test, release)
#
# What these variables actually specify is a .mk file for this make file to include
# according to the template:
#
#           targets/TGT/ENV.mk
#
# examples of how to use this Makefile:
#   
#   $ make                      # builds x86 development binary (default)
#   $ TGT=x86 ENV=devel make    # explcitly builds x86 development binary (default)
#   $ TGT=i386 ENV=release make # builds release i386
#   $ TGT=i386 make             # builds devel i386
#   $ ENV=devel make            # builds devel x86
#   $ ENV=flyingspaghettimonster make            # builds flyingspaghettimonster x86 (if such a thing exists)
#

SHELL=/bin/bash

TGT?=x86
ENV?=devel

.INCLUDE_DIRS += targets/$(TGT)/
include targets/$(TGT)/$(ENV).mk 

HACK := $(shell mkdir -p _$(TGT)_obs/)


default: all
_$(TGT)_obs/src_io_binary_StreamPutter.o: src/io/binary/StreamPutter.cpp  \
         include/io/binary/StreamPutter.hpp \
         include/io/binary/Putter.hpp \
         include/types.h \
         include/io/BaseIO.hpp \
         include/types.h
	$(CXX) -o _$(TGT)_obs/src_io_binary_StreamPutter.o $(CXXFLAGS) -c src/io/binary/StreamPutter.cpp

_$(TGT)_obs/src_io_binary_Putter.o: src/io/binary/Putter.cpp  \
         include/io/binary/Putter.hpp \
         include/types.h \
         include/io/binary/GlobPutter.hpp \
         include/io/binary/Putter.hpp \
         include/types.h
	$(CXX) -o _$(TGT)_obs/src_io_binary_Putter.o $(CXXFLAGS) -c src/io/binary/Putter.cpp

_$(TGT)_obs/src_io_FileDescriptor.o: src/io/FileDescriptor.cpp  \
         include/io/FileDescriptor.hpp \
         include/io/BaseIO.hpp \
         include/types.h
	$(CXX) -o _$(TGT)_obs/src_io_FileDescriptor.o $(CXXFLAGS) -c src/io/FileDescriptor.cpp

_$(TGT)_obs/src_io_Socket.o: src/io/Socket.cpp  \
         include/io/Socket.hpp \
         include/io/BaseIO.hpp \
         include/types.h
	$(CXX) -o _$(TGT)_obs/src_io_Socket.o $(CXXFLAGS) -c src/io/Socket.cpp

_$(TGT)_obs/src_io_ServerSocket.o: src/io/ServerSocket.cpp  \
         include/io/ServerSocket.hpp \
         include/types.h \
         include/io/Socket.hpp \
         include/io/BaseIO.hpp \
         include/types.h
	$(CXX) -o _$(TGT)_obs/src_io_ServerSocket.o $(CXXFLAGS) -c src/io/ServerSocket.cpp

_$(TGT)_obs/tests_helloworld.o: tests/helloworld.cpp 
	$(CXX) -o _$(TGT)_obs/tests_helloworld.o $(CXXFLAGS) -c tests/helloworld.cpp

_$(TGT)_obs/tests_getter_putter_test.o: tests/getter_putter_test.cpp  \
         include/io/binary/StreamPutter.hpp \
         include/io/binary/Putter.hpp \
         include/types.h \
         include/io/BaseIO.hpp \
         include/types.h \
         include/io/binary/StreamGetter.hpp \
         include/io/binary/Getter.hpp \
         include/types.h \
         include/io/BaseIO.hpp \
         include/types.h \
         include/io/FileDescriptor.hpp \
         include/io/BaseIO.hpp \
         include/types.h \
         include/test.h
	$(CXX) -o _$(TGT)_obs/tests_getter_putter_test.o $(CXXFLAGS) -c tests/getter_putter_test.cpp

clean:
	rm -rf _$(TGT)_obs/
	rm -f mercury

_$(TGT)_obs/libmerc.a:  _$(TGT)_obs/src_io_binary_StreamPutter.o _$(TGT)_obs/src_io_binary_Putter.o _$(TGT)_obs/src_io_FileDescriptor.o _$(TGT)_obs/src_io_Socket.o _$(TGT)_obs/src_io_ServerSocket.o _$(TGT)_obs/tests_helloworld.o _$(TGT)_obs/tests_getter_putter_test.o
	ar -r $@ $^

all: _$(TGT)_obs/libmerc.a   \
         include/io/Socket.hpp \
         include/io/BaseIO.hpp \
         include/types.h \
         include/io/ServerSocket.hpp \
         include/io/StringWriter.hpp \
         include/io/binary/StreamGetter.hpp \
         include/io/binary/Getter.hpp \
         include/types.h
	$(CXX) -o _$(TGT)_obs/mercury main.cpp $(CXXFLAGS) -L _$(TGT)_obs/ -lmerc
	ln -sf _$(TGT)_obs/mercury .

genmake: genmake.sh
	./genmake.sh > Makefile

tests: _$(TGT)_obs/libmerc.a
	mkdir -p _$(TGT)_obs/tests/
	for i in $$(ls tests/*.cpp) ; do \
		out=_$(TGT)_obs/$${i/%.cpp/} ; \
		if [ "$$i" -nt "$$out" ] ; then \
			echo g++ $$i -o $$out _$(TGT)_obs/libmerc.a ; \
			g++ $(CXXFLAGS) $$i -o $$out _$(TGT)_obs/libmerc.a ; \
		fi ; \
	done

test: tests
	./test.sh

cleanall:
	rm -rf _*_obs
	rm -f mercury
